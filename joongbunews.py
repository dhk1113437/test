# -*- coding: utf-8 -*-
"""joongbunews.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ndCKgMK_4JgY7J1sAApvJzNJcQ1_YBXU
"""

import requests
import datetime

# ===== [ì„¤ì •] =====
KEYWORDS = ["ê´‘ì„ ë¡œ ë‹¨ì„ ", "ê´‘ì¼€ì´ë¸” ë‹¨ì„ ", "ì¶©ì²­", "ì¶©ë‚¨", "ì¶©ë¶", "ëŒ€ì „", "ì„¸ì¢…", "ê°•ì›"]  # ì›í•˜ëŠ” í‚¤ì›Œë“œë¡œ ìˆ˜ì •
TOKEN = "7850330463:AAFQ7gjUc4tNp1Tv68YDUDc-e6oS5fDUf4c"           # í…”ë ˆê·¸ë¨ ë´‡ í† í°
CHAT_ID = "7737652316"                                             # í…”ë ˆê·¸ë¨ ì±„íŒ… ID

# ë„¤ì´ë²„ API ì¸ì¦ ì •ë³´ (ë°˜ë“œì‹œ ë³¸ì¸ ì •ë³´ë¡œ ë³€ê²½)
NAVER_CLIENT_ID = "E8O90EX19G9rVFg6SyFY"
NAVER_CLIENT_SECRET = "ChywCbWRGX"

# ===== [1] ë„¤ì´ë²„ ë‰´ìŠ¤ API í•¨ìˆ˜ =====
def crawl_naver_news(keywords):
    print("ğŸŸ¢ [NAVER] ë‰´ìŠ¤ APIë¡œ ìˆ˜ì§‘ ì¤‘...")
    results = []
    url = "https://openapi.naver.com/v1/search/news.json"
    headers = {
        "X-Naver-Client-Id": NAVER_CLIENT_ID,
        "X-Naver-Client-Secret": NAVER_CLIENT_SECRET
    }
    for keyword in keywords:
        params = {
            "query": keyword,
            "display": 3,  # í‚¤ì›Œë“œë‹¹ 3ê±´
            "sort": "date"
        }
        res = requests.get(url, headers=headers, params=params)
        if res.status_code == 200:
            items = res.json().get("items", [])
            for item in items:
                # HTML íƒœê·¸ ì œê±°
                import re
                title = re.sub('<.*?>', '', item.get("title", ""))
                link = item.get("link", "")
                results.append(f"[{keyword}] {title}\n{link}")
        else:
            print(f"âŒ ë„¤ì´ë²„ API í˜¸ì¶œ ì‹¤íŒ¨: {res.status_code} ({keyword})")
    return results

# ===== [2] í…”ë ˆê·¸ë¨ ì „ì†¡ í•¨ìˆ˜ =====
def send_telegram_message(message: str, token: str, chat_id: str):
    url = f"https://api.telegram.org/bot{token}/sendMessage"
    data = {
        "chat_id": chat_id,
        "text": message
    }
    response = requests.post(url, data=data)
    if response.status_code == 200:
        print("âœ… í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ")
    else:
        print(f"âŒ í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: {response.status_code}")

# ===== [3] ì‹¤í–‰ í•¨ìˆ˜ =====
def run():
    print(f"ğŸ“… [{datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹œì‘")
    news = crawl_naver_news(KEYWORDS)

    if news:
        message = f"ğŸ“° ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ ìš”ì•½ ({len(news)}ê±´):\n\n" + "\n\n".join(news)
        send_telegram_message(message, TOKEN, CHAT_ID)
    else:
        print("ğŸ“­ ìˆ˜ì§‘ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.")

# ===== [4] ì‹¤í–‰ =====
if __name__ == "__main__":
    run()